<!DOCTYPE html>
<html>

<link rel="stylesheet" href="firstpage.css">
<script src="firstpage.js" ></script>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

<head>
    <title>E-library ITB</title>
</head>

<body>

    <h1 class="header">
        <img src="logo-itb-512px.png" width="60" height="60" alt="logo itb"></img>
        <p class="judul"> UPT Perpustakaan ITB </p>
    </h1>

    <div class="tab" style="display: inline-flexbox;">
        <button class="tablinks" onclick="openTable(event, 'Search')">Search</button>
        <button class="tablinks" onclick="openTable(event, 'Contact')">Contact</button>
        <!-- <button class="tablinks" onclick="openTable(event, 'About')">About</button> -->
        <button href="#notification" class="notification" style="background-color: dodgerblue;">Notification</button>
    </div>

    <!-- <form action="" target="_self" method="get"> -->
    <p padding: 10px></p>
    <div id="Search" class="tabcontent">
        <fieldset id="corners">
            <legend>Search</legend>
            <div class="topnav">
                <form method="GET" action="#">
                    <p padding: 20px></p>
                    Judul : <input class="topnav" type="text" placeholder="Mencari Berdasarkan Judul..." name="judul" id="judul" style="float: left;"><br>
                    <p padding: 20px></p>
                    <!-- Pengarang : <input class="topnav" type="text" placeholder="Mencari Berdasarkan Pengarang..." name="author" id="author" style="float: left"><br>
                    <p padding: 10px></p> -->
                    <select style="width: 100px;" id="bookjurnal">
                        <option value="book">Book</option>
                        <option value="jurnal">Jurnal</option>
                    </select><br>
                    <button id="cariData" onclick="showtabel()" style="width: 50px; height: 30px;">submit</button>
                </form>
            </div><br>
        </fieldset>
        <!-- </form> -->
        
        <!-- tabel hasil pencarian -->
        <table class="tabBuku" id="tabelBuku" style="display: none">
            <thead id="tabheadbuku">
                <tr>
                    <th>ISBN</th>
                    <th>Judul</th>
                    <th>Pengarang</th>
                    <th>Penerbit</th>
                    <th>Tahun Terbit</th>
                    <th>Kategori</th>
                    <th>Stok</th>
                <tr>
            </thead>
            <tbody id="tabbodybuku"></tbody>
        </table>
        <table class="tabBuku" id="tabelJurnal" style="display: none">
        <thead id="tabheadjurnal">
            <tr>
                <th>ID Jurnal</th>
                <th>Judul</th>
                <th>Pengarang</th>
                <th>Tahun Terbit</th>
                <th>Kategori</th>
                <th>Stok</th>
            <tr>
        </thead>
        <tbody id="tabbodyjurnal"></tbody>
        </table>

        <!-- Detail Modal -->
        <div id="detailModal" class="modal">
            <!-- Modal content -->
            <div class="modal-content">
                <span class="close">&times;</span>
                <p id="iiiooo"></p>
            </div>
        </div>
        <!-- Peminjaman Modal -->
        <div id="borrowModal" class="modal">
            <!-- Modal content -->
            <div class="modal-content">
                <span class="close">&times;</span>
                    <form id="formpinjam" method="POST" action="#">
                        <h1>Form Peminjaman Buku/Jurnal</h1>
                        <p>Isi data dibawah ini :</p>
                        
                        <label for="tanda">ISBN/ID Jurnal yang diinginkan :</label>
                        <input type="text" id="masukkan" disabled>
                        <input type="hidden" id="tipepinjaman">
                        
                        <label for="NIM">ID NIM :</label>
                        <input type="text" id="NIM" name="NIM" placeholder="Masukkan NIM..." required>

                        <button id="submitPinjam">submit</button>
                    </form>
                    <p id="result" style="display: none;"></p>
            </div>
        </div>
    </div>
    </div>

    <!-- JQUERY AJAX -->
    <script>
        $(document).ready(function(){
            $("#cariData").click(function(e) {
                e.preventDefault();
                var e = document.getElementById('bookjurnal');
                var pilihan = e.options[e.selectedIndex].value;
                if(pilihan=='book'){
                    var endpoint = 'http://localhost:3000/book';
                    var tabmodiv = document.getElementById('tabbodybuku');
                    document.getElementById('tabelBuku').style.display = 'block';
                    document.getElementById('tabelJurnal').style.display = 'none';
                } else {
                    var endpoint = 'http://localhost:3000/jurnal';
                    var tabmodiv = document.getElementById('tabbodyjurnal');
                    document.getElementById('tabelJurnal').style.display = 'block';
                    document.getElementById('tabelBuku').style.display = 'none';
                }
                $.ajax({
                    url: endpoint+'?judul='+encodeURIComponent(document.getElementById('judul').value),
                    type:'GET',
                    dataType: 'json',
                    success: function(response) {
                        content="";
                        if (pilihan == 'book') {
                            $.each(response, function(key, value){
                            content+=
                                "<tr>" +
                                    "<td>"+value.ISBN+"</th>\n" +
                                    "<td>"+value.Judul_Buku+"</th>\n" +
                                    "<td>"+value.Pengarang+"</th>\n" +
                                    "<td>"+value.Penerbit+"</th>\n" +
                                    "<td>"+value.Tahun_Terbit+"</th>\n" +
                                    "<td>"+value.Kategori+"</th>\n" +
                                    "<td>"+value.Stok_Buku+"</th>\n" +
                                    "<td><button id=\"dModal\" onclick=\"showdetail('"+value.Sinopsis+"')\"> Detail</button>" +
                                    "<td><button id=\"pModal\" onclick=\"showborrow('"+value.ISBN+"',1)\"> Pinjam</button>" +
                                "</tr>";
                            });
                        } else {
                            $.each(response, function(key, value){
                            content+=
                                "<tr>" +
                                    "<td>"+value.IDJurnal+"</th>\n" +
                                    "<td>"+value.Judul_Jurnal+"</th>\n" +
                                    "<td>"+value.Pengarang_Jurnal+"</th>\n" +
                                    "<td>"+value.Tahun_Terbit_Jurnal+"</th>\n" +
                                    "<td>"+value.Kategori_Jurnal+"</th>\n" +
                                    "<td>"+value.Stok_Jurnal+"<th>\n" +
                                    "<td><button id=\"dModal\" onclick=\"showdetail('"+value.Sinopsis+"')\"> Detail</button>" +
                                    "<td><button id=\"pModal\" onclick=\"showborrow('"+value.IDJurnal+"',2)\"> Pinjam</button>" +
                                "<tr>";
                            });
                        }
                        tabmodiv.innerHTML = content;
                    },
                    error: function(response) {
                        console.log(response);
                    }
                });
            });

            // $("#submitPinjam").click(function() {
            //     var elemen = document.getElementById('masukkan').innerHTML;
            //     // var Kategori = ''
            //     // if (elemen == ISBN) {
            //     //     var endpoint = 'http://localhost:3000/peminjaman?ISBM='+elemen;
            //     // } else {
            //     //     var endpoint = 'http://localhost:3000/peminjaman?IDJurnal='+elemen;
            //     // }
            //     $.ajax({
            //         url: "http://localhost:3000/peminjaman",
            //         type: "POST",
            //         dataType: "json",
            //         data: {
            //             idbukujurnal: elemen,
            //             nim: document.getElementById('NIM'),
            //         },
            //         success: function(response) {
            //             document.getElementById('result').innerHTML = response['message'];
            //             console.log(response);
            //         },
            //         error: function(error) {
            //             console.log(response);
            //         }
            //     });
            // });
        });

        $("#submitPinjam").click(function(e) {

            /* stop form from submitting normally */
            e.preventDefault();

            /* get the action attribute from the <form action=""> element */
            url = 'http://localhost:3000/peminjaman';

            /* Send the data using post with element id name and name2*/
            var elemen = document.getElementById('tipepinjaman').value;
            if (elemen == '') {
                var posting = $.post(url, {ISBN :$(elemen), NIM :$('#NIM').val});
            } else {
                var posting = $.post(url, {ID_Jurnal :$(elemen), NIM :$('#NIM').val});
            }

            /* Alerts the results */
            posting.done(function( data ) {
                document.getElementById('result').innerHTML = data['message'];
            });
        });
    </script>

</body>

</html>